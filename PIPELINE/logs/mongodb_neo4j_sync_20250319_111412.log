2025-03-19 11:14:12,311 - root - INFO - Starting MongoDB to Neo4j sync service
2025-03-19 11:14:12,311 - root - INFO - Sync interval: 5 minutes
2025-03-19 11:14:12,311 - root - INFO - Starting full sync job at 2025-03-19 11:14:12.311189
2025-03-19 11:14:18,271 - src.spark.session - INFO - Spark session created successfully
2025-03-19 11:14:18,376 - src.graph.neo4j_client - INFO - Connected to Neo4j database
2025-03-19 11:14:18,388 - src.graph.neo4j_client - INFO - Neo4j schema initialized
2025-03-19 11:14:18,389 - root - INFO - Extracting data from MongoDB...
2025-03-19 11:14:24,327 - src.etl.extract - INFO - Extracted 50 records from Person
2025-03-19 11:14:25,602 - src.etl.extract - INFO - Extracted 10 records from Company
2025-03-19 11:14:26,620 - src.etl.extract - INFO - Extracted 93 records from Loan
2025-03-19 11:14:27,631 - src.etl.extract - INFO - Extracted 57 records from PrimaryApplicant
2025-03-19 11:14:28,506 - src.etl.extract - INFO - Extracted 93 records from Coapplicant
2025-03-19 11:14:29,560 - src.etl.extract - INFO - Extracted 183 records from Reference
2025-03-19 11:14:29,568 - root - INFO - Loading nodes into Neo4j...
2025-03-19 11:14:34,458 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(0) already exists with label `Person` and property `personId` = 'PERSON001'
2025-03-19 11:14:35,612 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(1) already exists with label `Person` and property `personId` = 'PERSON002'
2025-03-19 11:14:36,660 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(2) already exists with label `Person` and property `personId` = 'PERSON003'
2025-03-19 11:14:37,701 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(3) already exists with label `Person` and property `personId` = 'PERSON004'
2025-03-19 11:14:38,754 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(4) already exists with label `Person` and property `personId` = 'PERSON005'
2025-03-19 11:14:39,735 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(5) already exists with label `Person` and property `personId` = 'PERSON006'
2025-03-19 11:14:40,821 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(6) already exists with label `Person` and property `personId` = 'PERSON007'
2025-03-19 11:14:41,793 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(7) already exists with label `Person` and property `personId` = 'PERSON008'
2025-03-19 11:14:42,742 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(8) already exists with label `Person` and property `personId` = 'PERSON009'
2025-03-19 11:14:43,663 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(9) already exists with label `Person` and property `personId` = 'PERSON010'
2025-03-19 11:14:44,531 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(10) already exists with label `Person` and property `personId` = 'PERSON011'
2025-03-19 11:14:45,498 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(11) already exists with label `Person` and property `personId` = 'PERSON012'
2025-03-19 11:14:46,429 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(12) already exists with label `Person` and property `personId` = 'PERSON013'
2025-03-19 11:14:47,349 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(13) already exists with label `Person` and property `personId` = 'PERSON014'
2025-03-19 11:14:48,185 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(14) already exists with label `Person` and property `personId` = 'PERSON015'
2025-03-19 11:14:49,104 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(15) already exists with label `Person` and property `personId` = 'PERSON016'
2025-03-19 11:14:49,975 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(16) already exists with label `Person` and property `personId` = 'PERSON017'
2025-03-19 11:14:51,008 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(17) already exists with label `Person` and property `personId` = 'PERSON018'
2025-03-19 11:14:51,906 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(18) already exists with label `Person` and property `personId` = 'PERSON019'
2025-03-19 11:14:52,793 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(19) already exists with label `Person` and property `personId` = 'PERSON020'
2025-03-19 11:14:53,698 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(20) already exists with label `Person` and property `personId` = 'PERSON021'
2025-03-19 11:14:54,583 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(21) already exists with label `Person` and property `personId` = 'PERSON022'
2025-03-19 11:14:55,430 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(22) already exists with label `Person` and property `personId` = 'PERSON023'
2025-03-19 11:14:56,397 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(23) already exists with label `Person` and property `personId` = 'PERSON024'
2025-03-19 11:14:57,288 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(24) already exists with label `Person` and property `personId` = 'PERSON025'
2025-03-19 11:14:58,235 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(25) already exists with label `Person` and property `personId` = 'PERSON026'
2025-03-19 11:14:59,109 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(26) already exists with label `Person` and property `personId` = 'PERSON027'
2025-03-19 11:14:59,976 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(27) already exists with label `Person` and property `personId` = 'PERSON028'
2025-03-19 11:15:00,907 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(28) already exists with label `Person` and property `personId` = 'PERSON029'
2025-03-19 11:15:02,018 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(29) already exists with label `Person` and property `personId` = 'PERSON030'
2025-03-19 11:15:03,080 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(30) already exists with label `Person` and property `personId` = 'PERSON031'
2025-03-19 11:15:04,125 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(31) already exists with label `Person` and property `personId` = 'PERSON032'
2025-03-19 11:15:05,168 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(32) already exists with label `Person` and property `personId` = 'PERSON033'
2025-03-19 11:15:06,255 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(33) already exists with label `Person` and property `personId` = 'PERSON034'
2025-03-19 11:15:07,292 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(34) already exists with label `Person` and property `personId` = 'PERSON035'
2025-03-19 11:15:08,404 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(35) already exists with label `Person` and property `personId` = 'PERSON036'
2025-03-19 11:15:09,395 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(36) already exists with label `Person` and property `personId` = 'PERSON037'
2025-03-19 11:15:10,276 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(37) already exists with label `Person` and property `personId` = 'PERSON038'
2025-03-19 11:15:11,127 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(38) already exists with label `Person` and property `personId` = 'PERSON039'
2025-03-19 11:15:12,031 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(39) already exists with label `Person` and property `personId` = 'PERSON040'
2025-03-19 11:15:12,904 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(40) already exists with label `Person` and property `personId` = 'PERSON041'
2025-03-19 11:15:13,689 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(41) already exists with label `Person` and property `personId` = 'PERSON042'
2025-03-19 11:15:14,551 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(42) already exists with label `Person` and property `personId` = 'PERSON043'
2025-03-19 11:15:15,382 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(43) already exists with label `Person` and property `personId` = 'PERSON044'
2025-03-19 11:15:16,205 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(44) already exists with label `Person` and property `personId` = 'PERSON045'
2025-03-19 11:15:17,029 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(45) already exists with label `Person` and property `personId` = 'PERSON046'
2025-03-19 11:15:17,898 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(46) already exists with label `Person` and property `personId` = 'PERSON047'
2025-03-19 11:15:18,707 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(47) already exists with label `Person` and property `personId` = 'PERSON048'
2025-03-19 11:15:19,578 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(48) already exists with label `Person` and property `personId` = 'PERSON049'
2025-03-19 11:15:20,495 - src.graph.neo4j_client - ERROR - Error upserting Person node: [Schema.ConstraintValidationFailed] Node(49) already exists with label `Person` and property `personId` = 'PERSON050'
2025-03-19 11:15:20,497 - src.etl.load - INFO - Loaded 0 Person nodes
2025-03-19 11:15:22,370 - src.etl.load - INFO - Loaded 93 Loan nodes
2025-03-19 11:15:28,633 - src.spark.session - INFO - Updated sync timestamp for Loan to 2025-03-19T05:45:22.370988Z
2025-03-19 11:15:29,401 - src.etl.load - INFO - Loaded 10 Company nodes
2025-03-19 11:15:35,371 - src.spark.session - INFO - Updated sync timestamp for Company to 2025-03-19T05:45:29.402554Z
2025-03-19 11:15:35,372 - root - INFO - Loading relationships into Neo4j...
2025-03-19 11:15:38,310 - src.etl.load - INFO - Created 93 PrimaryApplicant-Loan relationships
2025-03-19 11:15:43,554 - src.spark.session - INFO - Updated sync timestamp for PrimaryApplicant to 2025-03-19T05:45:38.311316Z
2025-03-19 11:15:46,616 - src.etl.load - INFO - Created 93 Loan-CoApplicant relationships
2025-03-19 11:15:51,861 - src.spark.session - INFO - Updated sync timestamp for Coapplicant to 2025-03-19T05:45:46.617153Z
2025-03-19 11:15:55,170 - src.etl.load - INFO - Created 183 Loan-Reference relationships
2025-03-19 11:16:00,315 - src.spark.session - INFO - Updated sync timestamp for Reference to 2025-03-19T05:45:55.170622Z
2025-03-19 11:16:02,222 - src.etl.load - INFO - Created 50 Person-Company relationships
2025-03-19 11:16:02,223 - root - INFO - Sync job completed in 109.91 seconds
2025-03-19 11:16:02,223 - root - INFO - Nodes loaded: 0 Persons, 93 Loans, 10 Companies
2025-03-19 11:16:02,223 - root - INFO - Relationships loaded: 93 Primary, 93 CoApplicant, 183 Reference, 50 Company
2025-03-19 11:21:03,811 - root - INFO - Starting incremental sync job at 2025-03-19 11:21:03.811510
2025-03-19 11:21:04,603 - src.spark.session - INFO - Spark session created successfully
2025-03-19 11:21:04,607 - src.graph.neo4j_client - INFO - Connected to Neo4j database
2025-03-19 11:21:04,615 - src.graph.neo4j_client - INFO - Neo4j schema initialized
2025-03-19 11:21:04,615 - root - INFO - Extracting data from MongoDB...
2025-03-19 11:21:10,261 - src.etl.extract - INFO - Extracting Person data modified since 1970-01-01T00:00:00.000Z
2025-03-19 11:21:10,420 - src.etl.extract - ERROR - Error extracting collection Person: [UNRESOLVED_COLUMN.WITH_SUGGESTION] A column or function parameter with name `lastUpdated` cannot be resolved. Did you mean one of the following? [`aadhar`, `name`, `pan`, `phone`, `_id`].;
'Filter ('lastUpdated > 1970-01-01T00:00:00.000Z)
+- Relation [_id#2944,aadhar#2945,address#2946,companyId#2947,dateOfBirth#2948,email#2949,income#2950,name#2951,pan#2952,personId#2953,phone#2954,position#2955,roles#2956,yearsEmployed#2957] MongoRelation(MongoRDD[0] at RDD at MongoRDD.scala:51,Some(StructType(StructField(_id,StructType(StructField(oid,StringType,true)),true),StructField(aadhar,StringType,true),StructField(address,StringType,true),StructField(companyId,StringType,true),StructField(dateOfBirth,StringType,true),StructField(email,StringType,true),StructField(income,IntegerType,true),StructField(name,StringType,true),StructField(pan,StringType,true),StructField(personId,StringType,true),StructField(phone,StringType,true),StructField(position,StringType,true),StructField(roles,StructType(StructField(coApplicant,ArrayType(StringType,true),true),StructField(primaryApplicant,ArrayType(StringType,true),true),StructField(reference,ArrayType(StringType,true),true)),true),StructField(yearsEmployed,IntegerType,true))))

2025-03-19 11:21:15,727 - src.etl.extract - INFO - Extracting Company data modified since 2025-03-18T18:53:34.615993Z
2025-03-19 11:21:15,776 - src.etl.extract - ERROR - Error extracting collection Company: [UNRESOLVED_COLUMN.WITH_SUGGESTION] A column or function parameter with name `lastUpdated` cannot be resolved. Did you mean one of the following? [`founded`, `gst_number`, `name`, `phone`, `website`].;
'Filter ('lastUpdated > 2025-03-18T18:53:34.615993Z)
+- Relation [_id#2989,address#2990,companyId#2991,founded#2992,gst_number#2993,name#2994,phone#2995,sector#2996,website#2997] MongoRelation(MongoRDD[23] at RDD at MongoRDD.scala:51,Some(StructType(StructField(_id,StructType(StructField(oid,StringType,true)),true),StructField(address,StringType,true),StructField(companyId,StringType,true),StructField(founded,StringType,true),StructField(gst_number,StringType,true),StructField(name,StringType,true),StructField(phone,StringType,true),StructField(sector,StringType,true),StructField(website,StringType,true))))

2025-03-19 11:21:20,718 - src.etl.extract - INFO - Extracting Loan data modified since 2025-03-18T18:53:25.663309Z
2025-03-19 11:21:20,732 - src.etl.extract - ERROR - Error extracting collection Loan: [UNRESOLVED_COLUMN.WITH_SUGGESTION] A column or function parameter with name `lastUpdated` cannot be resolved. Did you mean one of the following? [`status`, `amount`, `loanType`, `_id`, `decisionDate`].;
'Filter ('lastUpdated > 2025-03-18T18:53:25.663309Z)
+- Relation [_id#3024,amount#3025,applicationDate#3026,coapplicantId#3027,decisionDate#3028,interestRate#3029,loanId#3030,loanType#3031,primaryApplicantId#3032,references#3033,status#3034,term#3035] MongoRelation(MongoRDD[46] at RDD at MongoRDD.scala:51,Some(StructType(StructField(_id,StructType(StructField(oid,StringType,true)),true),StructField(amount,IntegerType,true),StructField(applicationDate,TimestampType,true),StructField(coapplicantId,StringType,true),StructField(decisionDate,TimestampType,true),StructField(interestRate,DoubleType,true),StructField(loanId,StringType,true),StructField(loanType,StringType,true),StructField(primaryApplicantId,StringType,true),StructField(references,ArrayType(StringType,true),true),StructField(status,StringType,true),StructField(term,IntegerType,true))))

2025-03-19 11:21:25,585 - src.etl.extract - INFO - Extracting PrimaryApplicant data modified since 2025-03-18T18:53:45.323152Z
2025-03-19 11:21:25,610 - src.etl.extract - ERROR - Error extracting collection PrimaryApplicant: [UNRESOLVED_COLUMN.WITH_SUGGESTION] A column or function parameter with name `lastUpdated` cannot be resolved. Did you mean one of the following? [`name`, `pan`, `_id`, `loans`, `personId`].;
'Filter ('lastUpdated > 2025-03-18T18:53:45.323152Z)
+- Relation [_id#3065,isCoApplicantFor#3066,isReferenceFor#3067,loans#3068,name#3069,pan#3070,personId#3071,primaryApplicantId#3072] MongoRelation(MongoRDD[69] at RDD at MongoRDD.scala:51,Some(StructType(StructField(_id,StructType(StructField(oid,StringType,true)),true),StructField(isCoApplicantFor,ArrayType(StringType,true),true),StructField(isReferenceFor,ArrayType(StringType,true),true),StructField(loans,ArrayType(StringType,true),true),StructField(name,StringType,true),StructField(pan,StringType,true),StructField(personId,StringType,true),StructField(primaryApplicantId,StringType,true))))

2025-03-19 11:21:30,578 - src.etl.extract - INFO - Extracting Coapplicant data modified since 2025-03-18T18:53:54.899035Z
2025-03-19 11:21:30,599 - src.etl.extract - ERROR - Error extracting collection Coapplicant: [UNRESOLVED_COLUMN.WITH_SUGGESTION] A column or function parameter with name `lastUpdated` cannot be resolved. Did you mean one of the following? [`name`, `pan`, `_id`, `linkedTo`, `loanId`].;
'Filter ('lastUpdated > 2025-03-18T18:53:54.899035Z)
+- Relation [_id#3098,coApplicantId#3099,linkedTo#3100,loanId#3101,name#3102,pan#3103,personId#3104,relationToPrimary#3105] MongoRelation(MongoRDD[92] at RDD at MongoRDD.scala:51,Some(StructType(StructField(_id,StructType(StructField(oid,StringType,true)),true),StructField(coApplicantId,StringType,true),StructField(linkedTo,StringType,true),StructField(loanId,StringType,true),StructField(name,StringType,true),StructField(pan,StringType,true),StructField(personId,StringType,true),StructField(relationToPrimary,StringType,true))))

2025-03-19 11:21:35,403 - src.etl.extract - INFO - Extracting Reference data modified since 2025-03-18T18:54:04.557995Z
2025-03-19 11:21:35,422 - src.etl.extract - ERROR - Error extracting collection Reference: [UNRESOLVED_COLUMN.WITH_SUGGESTION] A column or function parameter with name `lastUpdated` cannot be resolved. Did you mean one of the following? [`name`, `pan`, `_id`, `linkedTo`, `loanId`].;
'Filter ('lastUpdated > 2025-03-18T18:54:04.557995Z)
+- Relation [_id#3131,linkedTo#3132,loanId#3133,name#3134,pan#3135,personId#3136,referenceId#3137,relationToBorrower#3138,yearsKnown#3139] MongoRelation(MongoRDD[115] at RDD at MongoRDD.scala:51,Some(StructType(StructField(_id,StructType(StructField(oid,StringType,true)),true),StructField(linkedTo,StringType,true),StructField(loanId,StringType,true),StructField(name,StringType,true),StructField(pan,StringType,true),StructField(personId,StringType,true),StructField(referenceId,StringType,true),StructField(relationToBorrower,StringType,true),StructField(yearsKnown,IntegerType,true))))

2025-03-19 11:21:35,424 - root - INFO - Loading nodes into Neo4j...
2025-03-19 11:21:35,424 - src.etl.load - INFO - No Person data to load
2025-03-19 11:21:35,424 - src.etl.load - INFO - No Loan data to load
2025-03-19 11:21:35,424 - src.etl.load - INFO - No Company data to load
2025-03-19 11:21:35,424 - root - INFO - Loading relationships into Neo4j...
2025-03-19 11:21:35,424 - src.etl.load - INFO - No PrimaryApplicant data to load
2025-03-19 11:21:35,424 - src.etl.load - INFO - No CoApplicant data to load
2025-03-19 11:21:35,425 - src.etl.load - INFO - No Reference data to load
2025-03-19 11:21:35,425 - src.etl.load - INFO - No Person data to load Person-Company relationships
2025-03-19 11:21:35,425 - root - INFO - Sync job completed in 31.61 seconds
2025-03-19 11:21:35,425 - root - INFO - Nodes loaded: 0 Persons, 0 Loans, 0 Companies
2025-03-19 11:21:35,425 - root - INFO - Relationships loaded: 0 Primary, 0 CoApplicant, 0 Reference, 0 Company
2025-03-19 11:22:19,354 - root - ERROR - Service stopped due to error: 'NoneType' object has no attribute 'sc'
Traceback (most recent call last):
  File ".\src\main.py", line 97, in main
    time.sleep(1)
  File "C:\Users\ADITI\anaconda3\envs\spark_env\lib\site-packages\pyspark\context.py", line 381, in signal_handler
    self.cancelAllJobs()
  File "C:\Users\ADITI\anaconda3\envs\spark_env\lib\site-packages\pyspark\context.py", line 2446, in cancelAllJobs
    self._jsc.sc().cancelAllJobs()
AttributeError: 'NoneType' object has no attribute 'sc'
